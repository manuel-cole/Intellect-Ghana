/* /js/lib/es5-shim.min.js-/js/lib/json2.js-/js/lib/class.js-/js/jquery.cookie.min.js-/js/hgm/main.js-/js/hgm/cookie.js-/js/hgm/storage.js-/js/hgm/event.js-/js/hgm/geo.js-/js/hgm/popup.js - 1.3818740844727ms - 06/05/15 01:35:28 PM */
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2014 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/master/LICENSE
 */
(function(t,r){if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Function.prototype.call;var r=Array.prototype;var e=Object.prototype;var n=r.slice;var i=Array.prototype.splice;var o=Array.prototype.push;var a=Array.prototype.unshift;var l=function(t){return e.toString.call(t)==="[object Function]"};var u=function(t){return e.toString.call(t)==="[object RegExp]"};function p(){}if(!Function.prototype.bind){Function.prototype.bind=function H(t){var r=this;if(!l(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var e=n.call(arguments,1);var i=function(){if(this instanceof s){var i=r.apply(this,e.concat(n.call(arguments)));if(Object(i)===i){return i}return this}else{return r.apply(t,e.concat(n.call(arguments)))}};var o=Math.max(0,r.length-e.length);var a=[];for(var u=0;u<o;u++){a.push("$"+u)}var s=Function("binder","return function("+a.join(",")+"){return binder.apply(this,arguments)}")(i);if(r.prototype){p.prototype=r.prototype;s.prototype=new p;p.prototype=null}return s}}var s=t.bind(e.hasOwnProperty);var f=t.bind(e.toString);var c;var h;var y;var g;var v;if(v=s(e,"__defineGetter__")){c=t.bind(e.__defineGetter__);h=t.bind(e.__defineSetter__);y=t.bind(e.__lookupGetter__);g=t.bind(e.__lookupSetter__)}if([1,2].splice(0).length!==2){if(function(){function t(t){var r=[];while(t--){r.unshift(t)}return r}var r=[];var e;r.splice.bind(r,0,0).apply(null,t(20));r.splice.bind(r,0,0).apply(null,t(26));e=r.length;r.splice(5,0,"XXX");if(e+1===r.length){return true}}()){Array.prototype.splice=function(t,r){if(!arguments.length){return[]}else{return i.apply(this,[t===void 0?0:t,r===void 0?this.length-t:r].concat(n.call(arguments,2)))}}}else{Array.prototype.splice=function(t,r){var e;var l=n.call(arguments,2);var u=l.length;if(!arguments.length){return[]}if(t===void 0){t=0}if(r===void 0){r=this.length-t}if(u>0){if(r<=0){if(t===this.length){o.apply(this,l);return[]}if(t===0){a.apply(this,l);return[]}}e=n.call(this,t,t+r);l.push.apply(l,n.call(this,t+r,this.length));l.unshift.apply(l,n.call(this,0,t));l.unshift(0,this.length);i.apply(this,l);return e}return i.call(this,t,r)}}}if([].unshift(0)!==1){Array.prototype.unshift=function(){a.apply(this,arguments);return this.length}}if(!Array.isArray){Array.isArray=function L(t){return f(t)==="[object Array]"}}var d=Object("a");var b=d[0]!=="a"||!(0 in d);var m=function Y(t){var r=true;if(t){t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}})}return!!t&&r};if(!Array.prototype.forEach||!m(Array.prototype.forEach)){Array.prototype.forEach=function q(t){var r=B(this),e=b&&f(this)==="[object String]"?this.split(""):r,n=arguments[1],i=-1,o=e.length>>>0;if(!l(t)){throw new TypeError}while(++i<o){if(i in e){t.call(n,e[i],i,r)}}}}if(!Array.prototype.map||!m(Array.prototype.map)){Array.prototype.map=function z(t){var r=B(this),e=b&&f(this)==="[object String]"?this.split(""):r,n=e.length>>>0,i=Array(n),o=arguments[1];if(!l(t)){throw new TypeError(t+" is not a function")}for(var a=0;a<n;a++){if(a in e)i[a]=t.call(o,e[a],a,r)}return i}}if(!Array.prototype.filter||!m(Array.prototype.filter)){Array.prototype.filter=function K(t){var r=B(this),e=b&&f(this)==="[object String]"?this.split(""):r,n=e.length>>>0,i=[],o,a=arguments[1];if(!l(t)){throw new TypeError(t+" is not a function")}for(var u=0;u<n;u++){if(u in e){o=e[u];if(t.call(a,o,u,r)){i.push(o)}}}return i}}if(!Array.prototype.every||!m(Array.prototype.every)){Array.prototype.every=function Q(t){var r=B(this),e=b&&f(this)==="[object String]"?this.split(""):r,n=e.length>>>0,i=arguments[1];if(!l(t)){throw new TypeError(t+" is not a function")}for(var o=0;o<n;o++){if(o in e&&!t.call(i,e[o],o,r)){return false}}return true}}if(!Array.prototype.some||!m(Array.prototype.some)){Array.prototype.some=function V(t){var r=B(this),e=b&&f(this)==="[object String]"?this.split(""):r,n=e.length>>>0,i=arguments[1];if(!l(t)){throw new TypeError(t+" is not a function")}for(var o=0;o<n;o++){if(o in e&&t.call(i,e[o],o,r)){return true}}return false}}var w=false;if(Array.prototype.reduce){w=typeof Array.prototype.reduce.call("a",function(t,r,e,n){return n})==="object"}if(!Array.prototype.reduce||!w){Array.prototype.reduce=function W(t){var r=B(this),e=b&&f(this)==="[object String]"?this.split(""):r,n=e.length>>>0;if(!l(t)){throw new TypeError(t+" is not a function")}if(!n&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var o;if(arguments.length>=2){o=arguments[1]}else{do{if(i in e){o=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){o=t.call(void 0,o,e[i],i,r)}}return o}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function tr(t){var r=B(this),e=b&&f(this)==="[object String]"?this.split(""):r,n=e.length>>>0;if(!l(t)){throw new TypeError(t+" is not a function")}if(!n&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i,o=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(o in e){i=e[o--];break}if(--o<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(o<0){return i}do{if(o in this){i=t.call(void 0,i,e[o],o,r)}}while(o--);return i}}if(!Array.prototype.indexOf||[0,1].indexOf(1,2)!==-1){Array.prototype.indexOf=function rr(t){var r=b&&f(this)==="[object String]"?this.split(""):B(this),e=r.length>>>0;if(!e){return-1}var n=0;if(arguments.length>1){n=$(arguments[1])}n=n>=0?n:Math.max(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}}if(!Array.prototype.lastIndexOf||[0,1].lastIndexOf(0,-3)!==-1){Array.prototype.lastIndexOf=function er(t){var r=b&&f(this)==="[object String]"?this.split(""):B(this),e=r.length>>>0;if(!e){return-1}var n=e-1;if(arguments.length>1){n=Math.min(n,$(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}}if(!Object.keys){var S=!{toString:null}.propertyIsEnumerable("toString"),x=function(){}.propertyIsEnumerable("prototype"),A=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],j=A.length,O=function nr(t){var r=f(t);var e=r==="[object Arguments]";if(!e){e=!Array.isArray(r)&&t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&l(t.callee)}return e};Object.keys=function ir(t){var r=l(t),e=O(t),n=t!==null&&typeof t==="object",i=n&&f(t)==="[object String]";if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var o=[];var a=x&&r;if(i||e){for(var u=0;u<t.length;++u){o.push(String(u))}}else{for(var p in t){if(!(a&&p==="prototype")&&s(t,p)){o.push(String(p))}}}if(S){var c=t.constructor,h=c&&c.prototype===t;for(var y=0;y<j;y++){var g=A[y];if(!(h&&g==="constructor")&&s(t,g)){o.push(g)}}}return o}}var E=-621987552e5,N="-000001";if(!Date.prototype.toISOString||new Date(E).toISOString().indexOf(N)===-1){Date.prototype.toISOString=function or(){var t,r,e,n,i;if(!isFinite(this)){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}n=this.getUTCFullYear();i=this.getUTCMonth();n+=Math.floor(i/12);i=(i%12+12)%12;t=[i+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()];n=(n<0?"-":n>9999?"+":"")+("00000"+Math.abs(n)).slice(0<=n&&n<=9999?-4:-6);r=t.length;while(r--){e=t[r];if(e<10){t[r]="0"+e}}return n+"-"+t.slice(0,2).join("-")+"T"+t.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"}}var T=false;try{T=Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(E).toJSON().indexOf(N)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(I){}if(!T){Date.prototype.toJSON=function ar(t){var r=Object(this),e=P(r),n;if(typeof e==="number"&&!isFinite(e)){return null}n=r.toISOString;if(typeof n!=="function"){throw new TypeError("toISOString property is not callable")}return n.call(r)}}var D=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var _=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"));var M=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(!Date.parse||M||_||!D){Date=function(t){function r(e,n,i,o,a,l,u){var p=arguments.length;if(this instanceof t){var s=p===1&&String(e)===e?new t(r.parse(e)):p>=7?new t(e,n,i,o,a,l,u):p>=6?new t(e,n,i,o,a,l):p>=5?new t(e,n,i,o,a):p>=4?new t(e,n,i,o):p>=3?new t(e,n,i):p>=2?new t(e,n):p>=1?new t(e):new t;s.constructor=r;return s}return t.apply(this,arguments)}var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];function i(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)}function o(r){return Number(new t(1970,0,1,0,0,0,r))}for(var a in t){r[a]=t[a]}r.now=t.now;r.UTC=t.UTC;r.prototype=t.prototype;r.prototype.constructor=r;r.parse=function l(r){var n=e.exec(r);if(n){var a=Number(n[1]),l=Number(n[2]||1)-1,u=Number(n[3]||1)-1,p=Number(n[4]||0),s=Number(n[5]||0),f=Number(n[6]||0),c=Math.floor(Number(n[7]||0)*1e3),h=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,g=Number(n[10]||0),v=Number(n[11]||0),d;if(p<(s>0||f>0||c>0?24:25)&&s<60&&f<60&&c<1e3&&l>-1&&l<12&&g<24&&v<60&&u>-1&&u<i(a,l+1)-i(a,l)){d=((i(a,l)+u)*24+p+g*y)*60;d=((d+s+v*y)*60+f)*1e3+c;if(h){d=o(d)}if(-864e13<=d&&d<=864e13){return d}}return NaN}return t.parse.apply(this,arguments)};return r}(Date)}if(!Date.now){Date.now=function lr(){return(new Date).getTime()}}if(!Number.prototype.toFixed||8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)==="0"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128"){(function(){var t,r,e,n;t=1e7;r=6;e=[0,0,0,0,0,0];function i(n,i){var o=-1;while(++o<r){i+=n*e[o];e[o]=i%t;i=Math.floor(i/t)}}function o(n){var i=r,o=0;while(--i>=0){o+=e[i];e[i]=Math.floor(o/n);o=o%n*t}}function a(){var t=r;var n="";while(--t>=0){if(n!==""||t===0||e[t]!==0){var i=String(e[t]);if(n===""){n=i}else{n+="0000000".slice(0,7-i.length)+i}}}return n}function l(t,r,e){return r===0?e:r%2===1?l(t,r-1,e*t):l(t*t,r/2,e)}function u(t){var r=0;while(t>=4096){r+=12;t/=4096}while(t>=2){r+=1;t/=2}return r}Number.prototype.toFixed=function p(t){var r,e,n,p,s,f,c,h;r=Number(t);r=r!==r?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=Number(this);if(e!==e){return"NaN"}if(e<=-1e21||e>=1e21){return String(e)}n="";if(e<0){n="-";e=-e}p="0";if(e>1e-21){s=u(e*l(2,69,1))-69;f=s<0?e*l(2,-s,1):e/l(2,s,1);f*=4503599627370496;s=52-s;if(s>0){i(0,f);c=r;while(c>=7){i(1e7,0);c-=7}i(l(10,c,1),0);c=s-1;while(c>=23){o(1<<23);c-=23}o(1<<c);i(1,1);o(2);p=a()}else{i(0,f);i(1<<-s,0);p=a()+"0.00000000000000000000".slice(2,2+r)}}if(r>0){h=p.length;if(h<=r){p=n+"0.0000000000000000000".slice(0,r-h+2)+p}else{p=n+p.slice(0,h-r)+"."+p.slice(h-r)}}else{p=n+p}return p}})()}var F=String.prototype.split;if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=/()??/.exec("")[1]===void 0;String.prototype.split=function(r,e){var n=this;if(r===void 0&&e===0)return[];if(Object.prototype.toString.call(r)!=="[object RegExp]"){return F.apply(this,arguments)}var i=[],o=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.extended?"x":"")+(r.sticky?"y":""),a=0,l,u,p,s;r=new RegExp(r.source,o+"g");n+="";if(!t){l=new RegExp("^"+r.source+"$(?!\\s)",o)}e=e===void 0?-1>>>0:e>>>0;while(u=r.exec(n)){p=u.index+u[0].length;if(p>a){i.push(n.slice(a,u.index));if(!t&&u.length>1){u[0].replace(l,function(){for(var t=1;t<arguments.length-2;t++){if(arguments[t]===void 0){u[t]=void 0}}})}if(u.length>1&&u.index<n.length){Array.prototype.push.apply(i,u.slice(1))}s=u[0].length;a=p;if(i.length>=e){break}}if(r.lastIndex===u.index){r.lastIndex++}}if(a===n.length){if(s||!r.test("")){i.push("")}}else{i.push(n.slice(a))}return i.length>e?i.slice(0,e):i}})()}else if("0".split(void 0,0).length){String.prototype.split=function ur(t,r){if(t===void 0&&r===0)return[];return F.apply(this,arguments)}}var R=String.prototype.replace;var C=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){t.push(e)});return t.length===1&&typeof t[0]==="undefined"}();if(!C){String.prototype.replace=function pr(t,r){var e=l(r);var n=u(t)&&/\)[*?]/.test(t.source);if(!e||!n){return R.apply(this,arguments)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var o=t.exec(e);t.lastIndex=i;o.push(arguments[n-2],arguments[n-1]);return r.apply(this,o)};return R.call(this,t,i)}}}if("".substr&&"0b".substr(-1)!=="b"){var k=String.prototype.substr;String.prototype.substr=function sr(t,r){return k.call(this,t<0?(t=this.length+t)<0?0:t:t,r)}}var U="  \n\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var Z="\u200b";if(!String.prototype.trim||U.trim()||!Z.trim()){U="["+U+"]";var J=new RegExp("^"+U+U+"*"),X=new RegExp(U+U+"*$");String.prototype.trim=function fr(){if(this===void 0||this===null){throw new TypeError("can't convert "+this+" to object")}return String(this).replace(J,"").replace(X,"")}}if(parseInt(U+"08")!==8||parseInt(U+"0x16")!==22){parseInt=function(t){var r=/^0[xX]/;return function e(n,i){n=String(n).trim();if(!Number(i)){i=r.test(n)?16:10}return t(n,i)}}(parseInt)}function $(t){t=+t;if(t!==t){t=0}else if(t!==0&&t!==1/0&&t!==-(1/0)){t=(t>0||-1)*Math.floor(Math.abs(t))}return t}function G(t){var r=typeof t;return t===null||r==="undefined"||r==="boolean"||r==="number"||r==="string"}function P(t){var r,e,n;if(G(t)){return t}e=t.valueOf;if(l(e)){r=e.call(t);if(G(r)){return r}}n=t.toString;if(l(n)){r=n.call(t);if(G(r)){return r}}throw new TypeError}var B=function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return Object(t)}});
//# sourceMappingURL=es5-shim.map;;

if(typeof JSON!=='object'){JSON={};}
(function(){'use strict';function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());;;

(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}
function Class(){if(!initializing&&this.init)
this.init.apply(this,arguments);}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class;};})();;;
(function(g,k,m){function n(a){return a}function p(a){a=decodeURIComponent(a.replace(j," "));0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));return a}var j=/\+/g,d=g.cookie=function(a,c,b){if(c!==m){b=g.extend({},d.defaults,b);null===c&&(b.expires=-1);if("number"===typeof b.expires){var h=b.expires,f=b.expires=new Date;f.setDate(f.getDate()+h)}c=d.json?JSON.stringify(c):String(c);return k.cookie=[encodeURIComponent(a),"=",d.raw?c:encodeURIComponent(c),b.expires?"; expires="+
b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join("")}c=d.raw?n:p;b=k.cookie.split("; ");for(var h=a?null:{},f=0,j=b.length;f<j;f++){var e=b[f].split("="),l=c(e.shift()),e=c(e.join("="));if(a&&a===l){h=d.json?JSON.parse(e):e;break}a||(h[l]=d.json?JSON.parse(e):e)}return h};d.defaults={};g.removeCookie=function(a,c){return null!==g.cookie(a)?(g.cookie(a,null,c),!0):!1}})(jQuery,document);;;

var hgm;(function(window,document,undefined){'use strict';var version='1.0';var useCdn=false;var localLibPath='/js/';var cdnLibPath='http://static.hgmsites.net';function getLibPath(bypassCdn){if(!bypassCdn&&useCdn){return cdnLibPath+'/js/'+version+'/';}
return localLibPath;}
function depends(libraries){if(typeof libraries==='string'){libraries=[libraries];}
var libPath=getLibPath();$.each(libraries,function(index,lib){if(typeof $.fn[lib==='form'?'ajaxSubmit':lib]!=='function'){$.ajax({async:false,url:libPath+'jquery.'+lib+'.min.js',dataType:'script'});}});}
function getScripts(scripts,callback,cache){if(typeof scripts==='string'){scripts=[scripts];}
var countdown=scripts.length,semaphore=function(){if(--countdown===0){callback();}};scripts.forEach(function(script){hgm.getScript(script,cache).done(semaphore);});}
function getScript(url,cache){return $.ajax({dataType:'script',cache:cache===undefined?true:cache,url:url});}
function qtip(element,message){if(!element){throw('element param to hgm.qtip is required!');}
depends(['qtip']);return $(element).qtip({style:{padding:5,background:'#FE511C',color:'white',textAlign:'center',border:{width:5,radius:10,color:'#FE511C'},tip:true,name:'dark'},content:message,position:{corner:{tooltip:'topMiddle',target:'bottomMiddle'}},show:{when:false,ready:true},hide:'blur'});}
var MOBILE_OPT_OUT_COOKIE='hgm_mobile_optout';function isMobileView(){return!!$.mobile;}
function isMobileDevice(agent){agent=(agent||window.navigator.userAgent).toLowerCase();if(agent.indexOf('android')!==-1){return agent.indexOf('mobile')!==-1;}
if(agent.indexOf('ipad')!==-1){return false;}
return/(iemobile|iphone|ipod|webos|symbianos|opera mini)/.test(agent);}
function mobileOptOut(){hgm.cookie.set(MOBILE_OPT_OUT_COOKIE,'true');document.location.reload(true);}
function mobileOptIn(){hgm.cookie.remove(MOBILE_OPT_OUT_COOKIE);document.location.reload(true);}
function addMobileSiteButton(){if(isMobileDevice()){var $footer=$('.footer-mobile');if($footer.length){var $link=$('<a class="mobile" href="#" title="Mobile Site">Mobile Optimized Site</a>');$link.click(mobileOptIn);$footer.append($link);}}}
function formValidator(jqObj,options){if(!jqObj){throw('jqObj param to hgm.form is required!');}
depends(['form','validate','qtip']);function getRules(options){if(options&&options.rules){return options.rules;}else{return{};}}
function getMessages(options){if(options&&options.messages){return options.messages;}else{return{};}}
var validator=jqObj.validate({submitHandler:function(form){$(form).ajaxSubmit({dataType:'json',success:function(data){if(options&&typeof options.submitHandler==='function'){options.submitHandler(data);}}});return false;},errorClass:'error',validClass:'valid',onkeyup:false,highlight:function(element,errorClass){$(element).parent().addClass(errorClass);},unhighlight:function(element,errorClass){$(element).parent().removeClass(errorClass);$(element).parent().find('ul.errors').remove();},rules:getRules(options),messages:getMessages(options),showErrors:function(errorMap,errorList){validator.validElements().removeClass('error');validator.validElements().addClass('valid');$('div.qtip').remove();var gotOneQtip=false;$.each(errorList,function(index,error){$(error.element).addClass('error');$(error.element).parent().addClass('error');$(error.element).removeClass('valid');if(!gotOneQtip){qtip(error.element,error.message);$(error.element).qtip('show');gotOneQtip=true;}});}});return validator;}
function loadLazyImages(){$('img.lazy').each(function(index,image){var $image=$(image),src=$image.data('src');if(src){$image.attr('src',src);if($image.hasClass('fitfill')){$image.imgFitFill();}}});}
var fbAppId=null;function setFbAppId(appId){fbAppId=appId;}
function isFbEnabled(){return!!(fbAppId&&window.FB);}
function isUserLoggedIn(){return hgm.cookie.get('hgm__user')!==null||(fbAppId&&hgm.cookie.get('fbsr_'+fbAppId)!==null);}
var userPreferences={};var prefsJsonReq=null;function savePreference(name,value){var url='/blocks/user-prefs/save/',data={prefs:name+':'+value};if(!prefsJsonReq){prefsJsonReq=$.getJSON(url,data,function(data){userPreferences=data;});}else{prefsJsonReq.done(function(){$.getJSON(url,data,function(data){userPreferences=data;});});}
userPreferences[name]=value;}
function getPreference(name){var deferred=$.Deferred();if(!prefsJsonReq){prefsJsonReq=$.getJSON('/blocks/user-prefs',function(data){userPreferences=data;});}
prefsJsonReq.done(function(data){deferred.resolve(data[name]);});return deferred.promise();}
var VALID_ZIP=/^\d{5}$/;function detectLocation(callback){var zipCode=hgm.cookie.get('zipcode');if(VALID_ZIP.test(zipCode)){callback(zipCode);}
else{$.get('/blocks/get-zip-code',function(zipCode){if(VALID_ZIP.test(zipCode)){hgm.cookie.set('zipcode',zipCode);callback(zipCode);}});}}
function validateZip(zip){var deferred=$.Deferred();if(VALID_ZIP.test(zip)){$.getJSON('/blocks/price-quote-form/get-city-state/zip/'+zip,function(data){if(data){data.zipcode=zip;deferred.resolve(data);}else{deferred.reject(zip);}});}else{deferred.reject(zip);}
return deferred.promise();}
var savedHash=null;var hashParams={};var MISSING_HASH='_';var REFERRER_HASH='ref';function extractHashParams(){if(savedHash===null||savedHash!==window.location.hash){hashParams={};var pairs,pair,name,value,missing;savedHash=window.location.hash;if(savedHash.length>1){pairs=savedHash.substring(1).split('&');for(var i=pairs.length-1;i>=0;--i){pair=pairs[i].split('=');name=pair[0];if(pair.length===1){missing=name;value=true;}
else{value=pair[1];}
hashParams[name]=value;}
if(missing){hashParams[MISSING_HASH]=missing;}}}}
function getHashParam(name,missingValue){extractHashParams();var param=name||MISSING_HASH;return hashParams.hasOwnProperty(param)?hashParams[param]:missingValue;}
function setHashParam(name,value){if(value==null){delete hashParams[name];}
else{hashParams[name]=String(value);}
savedHash='#'+$.param(hashParams);if(savedHash==='#'){savedHash='';}
window.location.hash=savedHash;}
function getHashReferrer(){return getHashParam(REFERRER_HASH);}
var ATTRIB_SOURCE_HASH='src';var ATTRIB_KEYWORD_HASH='lnk';var OLD_ATTRIB_KEYWORD_HASH='kwd';var ATTRIB_COOKIE='hgm.attrib';function setAttribCookieFromHash(){var source=getHashOrQueryStringParam(ATTRIB_SOURCE_HASH),keyword=getHashOrQueryStringParam(ATTRIB_KEYWORD_HASH)||getHashOrQueryStringParam(OLD_ATTRIB_KEYWORD_HASH);if(source||keyword){hgm.cookie.set(ATTRIB_COOKIE,JSON.stringify({src:source,lnk:keyword}),{expires:30});}}
function getHashOrQueryStringParam(name){return getHashParam(name,getQueryStringParam(name));}
function getQueryStringParam(name){var searchString=document.location.search.substr(1),parameters=searchString.split('&');for(var i=0;i<parameters.length;i++){var keyValuePair=parameters[i].split('='),parameterName=keyValuePair[0],parameterValue=keyValuePair[1];if(parameterName===name){return parameterValue;}}}
function getAttribCookieParam(name){var cookie=hgm.cookie.get(ATTRIB_COOKIE);if(cookie){var values=JSON.parse(cookie);if(typeof values==='object'){if(values.hasOwnProperty(OLD_ATTRIB_KEYWORD_HASH)){values={src:values[ATTRIB_SOURCE_HASH],lnk:values[OLD_ATTRIB_KEYWORD_HASH]};hgm.cookie.set(ATTRIB_COOKIE,JSON.stringify(values),{expires:30});}
if(values.hasOwnProperty(name)){return values[name];}}}
return null;}
function getSource(){return getHashParam(ATTRIB_SOURCE_HASH)||getAttribCookieParam(ATTRIB_SOURCE_HASH);}
function setSource(source){hgm.cookie.set(ATTRIB_COOKIE,JSON.stringify({src:source}));}
function getKeyword(){return getHashParam(ATTRIB_KEYWORD_HASH)||getHashParam(OLD_ATTRIB_KEYWORD_HASH)||getAttribCookieParam(ATTRIB_KEYWORD_HASH);}
function scv(id,p,num,type){var a='3498dferhvsdf',b='jdf9823wdfoi',v=p.substr(a.length,p.length-a.length-b.length)/100;if(v){num=num||1;scga(id,v,num);scgtm(id,v,num);scop(type);}}
function scgtm(id,v,num){var hgmPageData=window.hgmPageData;if(hgmPageData){hgmPageData.push({event:'lead',value:v,num:num,qid:id});}}
function scga(id,v,num){var ga=window._gaq;if(ga){ga.push(['_trackPageview']);ga.push(['_addTrans',id,'HGM',v]);ga.push(['_addItem',id,'pq','Price Quote','pq',v,num]);ga.push(['_trackTrans']);}}
function scop(type){window.optimizely=window.optimizely||[];window.optimizely.push(['trackEvent','lead_submitted_'+type,{'revenue':1*100}]);}
function trackEvent(category,action,label,value,interactive,callback){var ga=window._gaq;if(ga){if(callback){ga.push(['_set','hitCallback',callback]);}
ga.push(['_trackEvent',category,action,label||'',value||0,interactive===undefined?true:!interactive]);}}
function addOverlayToLeadGenFormType(form){var version,dotPos,referrer=getHashReferrer();if(referrer){version=form.version;dotPos=version.indexOf('.');if(dotPos!==-1&&version.indexOf('-'+referrer)===-1){form.version=(version.substring(0,dotPos)+'-'+referrer+version.substring(dotPos));return true;}}
return false;}
function pingView(articleId,tagIds){if(articleId){if(typeof tagIds==='object'&&tagIds.length){tagIds=JSON.stringify(tagIds);}else{tagIds='';}
$.get('/etc/ping_view.php?articleId='+articleId+'&tagIds='+encodeURIComponent(tagIds),function(data){debug(data);});}}
var console;var loadTimestamp=Date.now();var logTimestamp;function initConsole(){if(!window.console){window.isDebugMode=false;console=window.console={log:function(){}};}
else{console=window.console;if(typeof console.log==='object'){if(Function.prototype.bind){console.log=Function.prototype.call.bind(console.log,console);}
else{var realLog=console.log;console.log=function(){Function.prototype.call.call(realLog,console,Array.prototype.slice.call(arguments));};}}}}
function initDebug(){window.isDebugMode=$('html').data('debug');}
function setupErrorHandler(){if(!window.isDebugMode){window.onerror=function(message){debug('ERROR:',message);return true;};}}
function debug(){if(window.isDebugMode){var args=Array.prototype.slice.apply(arguments);args.unshift(getLogTimestamp());args.unshift('HGM');if(window.isTraceMode){args.push('\n\n'+new Error().stack.split('\n').slice(2).join('\n')+'\n');}
console.log.apply(console,args);}}
function getLogTimestamp(){var now=Date.now(),diff=logTimestamp?now-logTimestamp:-1;logTimestamp=now;return rightPad('      ',now-loadTimestamp)+(diff>=0?' +'+rightPad('     ',diff):'       ');}
function rightPad(padding,value){var full=padding+''+value;return full.substring(full.length-padding.length);}
var $safeArea;function blockDocumentWrite(){$safeArea=$('<div id="__HGM_safeads"></div>').appendTo('body');document.write=document.writeln=$safeArea.append.bind($safeArea);}
function lazyLoad(script,id){$(function(){var scr=document.createElement('script');scr.text=script;if(id){document.getElementById(id).appendChild(scr);}
else{$safeArea.append(scr);}});}
function registerFailedBlock(index){var $error=$('#failed-block-'+index);$error.find('img').click(function(){$error.find('div').toggle();debug($error.find('span').html()+'\n\n'+$error.find('pre')[0].innerText);});}
function reset(){savedHash=null;hashParams={};hgm.cookie.remove(ATTRIB_COOKIE);userPreferences={};}
initConsole();initDebug();setupErrorHandler();extractHashParams();$(function(){setAttribCookieFromHash();if(window.HGM_ENV==='production'||window.HGM_ENV==='staging'){blockDocumentWrite();}
loadLazyImages();});hgm={getLibPath:getLibPath,depends:depends,getScripts:getScripts,getScript:getScript,isMobileView:isMobileView,isMobileDevice:isMobileDevice,mobileOptOut:mobileOptOut,mobileOptIn:mobileOptIn,addMobileSiteButton:addMobileSiteButton,formValidator:formValidator,setFbAppId:setFbAppId,isFbEnabled:isFbEnabled,isUserLoggedIn:isUserLoggedIn,getHashParam:getHashParam,setHashParam:setHashParam,getHashReferrer:getHashReferrer,getSource:getSource,setSource:setSource,getKeyword:getKeyword,getPreference:getPreference,savePreference:savePreference,detectLocation:detectLocation,validateZip:validateZip,scv:scv,trackEvent:trackEvent,pingView:pingView,addOverlayToLeadGenFormType:addOverlayToLeadGenFormType,debug:debug,lazyLoad:lazyLoad,registerFailedBlock:registerFailedBlock,reset:reset,errors:{NOT_LOGGED_IN:1,NOT_CONNECTED:2,NOT_AUTHORIZED:3,UNKNOWN:999}};}(this,document));;;

(function(window,undefined){'use strict';var TEST_COOKIE='hgm.cookie.test';var isAvail;var isTesting=false;hgm.cookie={available:function(){if(isAvail===undefined){if(window.navigator&&'cookieEnabled'in window.navigator){isAvail=window.navigator.cookieEnabled;}
else{isAvail=!!$.cookie(TEST_COOKIE,'test');$.removeCookie(TEST_COOKIE);}}
return isAvail;},get:function(name,missingValue){return this.available()?$.cookie(name)||missingValue:missingValue;},getObject:function(key,missingValue){if(this.available()){var value=this.get(key);if(value){return JSON.parse(value);}}
return missingValue;},set:function(name,value,options){if(this.available()){var realOptions=$.extend({path:'/'},$.isNumeric(options)?{expires:options}:options);if(isTesting&&realOptions.hasOwnProperty('expires')){delete realOptions.expires;}
return $.cookie(name,value,realOptions);}
return null;},setObject:function(key,value,options){return hgm.cookie.set(key,JSON.stringify(value),options);},remove:function(name,options){return this.available()?$.removeCookie(name,$.extend({path:'/'},options)):false;},reset:function(avail,testing){isAvail=avail==null?undefined:!!avail;isTesting=!!testing;}};}(this));;;

(function(window,undefined){'use strict';var isAvail;hgm.storage={available:function(){if(isAvail===undefined){try{isAvail='localStorage'in window&&window.localStorage!==null;if(isAvail){window.localStorage.setItem('hgm.test.localStorage','1');window.localStorage.removeItem('hgm.test.localStorage');}}catch(e){isAvail=false;}}
return isAvail;},get:function(key,missingValue){if(this.available()){return window.localStorage.getItem(key)||missingValue;}
return missingValue;},getObject:function(key,missingValue){if(this.available()){var value=window.localStorage.getItem(key);if(value){return JSON.parse(value);}}
return missingValue;},getOrCookie:function(key,missingValue){if(this.available()){var value=this.get(key);if(!value){value=hgm.cookie.get(key);if(value){hgm.cookie.remove(key);this.set(key,value);}
else{value=missingValue;}}
return value;}
else{return hgm.cookie.get(key,missingValue);}},set:function(key,value){if(this.available()){window.localStorage.setItem(key,value);}},setObject:function(key,value){if(this.available()){window.localStorage.setItem(key,JSON.stringify(value));}},setOrCookie:function(key,value){if(this.available()){this.set(key,value);}
else{hgm.cookie.set(key,value,365);}},remove:function(key){if(this.available()){window.localStorage.removeItem(key);}},removeOrCookie:function(key){if(this.available()){this.remove(key);}
else{hgm.cookie.remove(key);}},reset:function(avail){isAvail=avail==null?undefined:!!avail;}};}(this));;;

(function(undefined){'use strict';var types={};function acquire(type,explicit,create,flags){var handlers=types[type];if(create){if(flags===undefined){flags='unique';}
if(!handlers){if(explicit){hgm.debug('event - create',type,'with',flags);}
handlers=types[type]=$.Callbacks(flags);handlers.flags=flags;}
else if(explicit&&flags!==handlers.flags){hgm.debug('event -',type,'has',handlers.flags,'instead of',flags);}}
return handlers||null;}
function doForEach(types,action){if(!types){throw new Error('Event type is required');}
types.split(' ').forEach(action);}
hgm.event={create:function(types,flags){doForEach(types,function(type){acquire(type,true,true,flags);});},on:function(types,handler){if(!handler){throw new Error('Handler is required');}
doForEach(types,function(type){var handlers=acquire(type,false,true);if(handlers){hgm.debug('event - on',type);handlers.add(handler);}});},off:function(types,handler){if(!handler){throw new Error('Handler is required');}
doForEach(types,function(event){var handlers=acquire(event);if(handlers){hgm.debug('event - off',event);handlers.remove(handler);}});},fire:function(types,data){doForEach(types,function(type){var handlers=acquire(type);if(handlers){hgm.debug('event - fire',type,'data',data);handlers.fire(data);}
else{hgm.debug('event - fire',type,'data',data,'no handlers');}});},fired:function(type){if(!type){throw new Error('Event type is required');}
var handlers=type&&acquire(type);return!!handlers&&handlers.fired();},types:function(){return Object.keys(types);},reset:function(){types={};}};}());;;

(function(undefined){'use strict';var GEO_KEY='hgm.geo';var GEO_HASH_KEY='geo';var ZIP_COOKIE='zipcode';var VALID_ZIP=/^\d{5}$/;var cached=false;var loader=null;var subscribers=null;hgm.geo={isValidZip:function(zip){return VALID_ZIP.test(zip)&&zip!=='00000';},subscribe:function(callback){if(!subscribers){subscribers=$.Callbacks('unique');}
subscribers.add(callback);if(cached){hgm.debug('geo - cached:',cached.city,cached.state,cached.zip);callback(cached);}
else if(cached===null){hgm.debug('geo - cached failed detection; ignoring');}
else{this.get();}},unsubscribe:function(callback){subscribers&&subscribers.remove(callback);},publish:function(){if(!subscribers){hgm.debug('geo - no subscribers');}
else if(cached){hgm.debug('geo - publish:',cached.city,cached.state,cached.zip);subscribers.fire(cached);}
else{hgm.debug('geo - nothing to publish');}},getZip:function(){var deferred=$.Deferred();this.get().done(function(geo){deferred.resolve(geo.zip);}).fail(function(){deferred.reject();});return deferred.promise();},get:function(){return cached||cached===null?$.when(cached):this.loadOrDetect();},loadOrDetect:function(){return loader||(loader=this.load()||this.loadZipOrDetect());},load:function(){var geo=this.loadFromHash()||this.loadFromStorage();if(geo){cached=geo;this.publish();return $.when(cached);}
else{return null;}},loadFromHash:function(){var hash=hgm.getHashParam(GEO_HASH_KEY),geo=this.parse(hash);if(geo){hgm.debug('geo - loaded hash:',geo.city,geo.state,geo.zip);return geo;}
else if(hash){hgm.debug('geo - invalid hash:',hash);}},loadFromStorage:function(){var cookie=hgm.storage.getOrCookie(GEO_KEY),geo=this.parse(cookie);if(geo){hgm.debug('geo - loaded cookie:',geo.city,geo.state,geo.zip);return geo;}
else if(cookie){hgm.storage.removeOrCookie(GEO_KEY);hgm.debug('geo - invalid cookie:',cookie);}
return null;},parse:function(packed){if(packed){var parts=packed.split('_');if(parts.length===3){return{city:parts[0],state:parts[1],zip:parts[2]};}}
return null;},loadZipOrDetect:function(){var loader=this.loadZip();if(loader){var deferred=$.Deferred();loader.done(function(geo){deferred.resolve(geo);}).fail(function(){this.detect().done(function(geo){deferred.resolve(geo);}).fail(function(){deferred.reject();});}.bind(this));return deferred.promise();}
else{return this.detect();}},loadZip:function(){var zip=hgm.cookie.get(ZIP_COOKIE);if(this.isValidZip(zip)){hgm.debug('geo - valid ZIP from cookie:',zip);return this.setZip(zip);}
else if(zip){hgm.debug('geo - invalid ZIP from cookie:',zip);hgm.cookie.remove(ZIP_COOKIE);}
return null;},detect:function(){hgm.debug('geo - detect from IP');return $.getJSON('/blocks/geo/detect').done(this.saveAndPublish.bind(this)).fail(function(jqxhr,textStatus,error){if(jqxhr.status===404){hgm.debug('geo - ZIP for IP not found');cached=null;}
else{hgm.debug('geo - ZIP detection failed:',textStatus,error);}});},saveAndPublish:function(geo){this.save(geo);this.publish();},save:function(geo){hgm.debug('geo - store:',geo.city,geo.state,geo.zip);cached=geo;hgm.storage.setOrCookie(GEO_KEY,geo.city+'_'+geo.state+'_'+geo.zip);hgm.cookie.set(ZIP_COOKIE,geo.zip);},setZip:function(zip){if(cached&&cached.zip===zip){hgm.debug('geo - ZIP not changed:',zip);return $.when(cached);}
else{return this.lookupCityState(zip).done(this.saveAndPublish.bind(this));}},lookupCityState:function(zip){if(this.isValidZip(zip)){hgm.debug('geo - look up ZIP',zip);return $.getJSON('/blocks/geo/get-city-state/zip/'+zip).done(function(geo){hgm.debug('geo - ZIP found:',geo.city,geo.state,geo.zip);}).fail(function(jqxhr,textStatus,error){if(jqxhr.status===404){hgm.debug('geo - ZIP not found');}
else{hgm.debug('geo - ZIP lookup failed:',textStatus,error);}});}
else{hgm.debug('geo - invalid ZIP:',zip);return $.Deferred().reject().promise();}},reset:function(geo,subs){cached=geo===undefined?false:geo;loader=null;if(subs){subscribers=$.Callbacks('unique');if($.type(subs)==='array'){for(var i=0;i<subs.length;i++){subscribers.add(subs[i]);}}
else{subscribers.add(subs);}}
else{subscribers=null;}},getCached:function(){return cached;}};}());;;

(function(undefined){'use strict';hgm.popup={GLOBAL_CAP:3,DEFAULT_TTL:30*60,groups:null,counters:null,shown:null,visible:false,fake:null,get:function(name,key,config){if(hgm.cookie.available()){var type=$.type(key);return type==='string'||type==='number'?this.group(name,config).get(String(key)):this.group(name,key).get('_');}
else{if(!this.fake){var falsy=function(){return false;},nothing=function(){};this.fake={countdown:falsy,count:function(){return 0;},shown:falsy,open:falsy,trigger:nothing,close:nothing};}
return this.fake;}},group:function(name,config){this.load();return this.groups[name]||this.createGroup(name,$.extend({views:1,ttl:30*60,cap:1,expire:365*24*60*60},config));},createGroup:function(name,config){if(config.views<1){throw new RangeError('config.views must be a positive integer');}
var counters=this.counters[name];if(!counters){counters=this.counters[name]={_expire:this.calcExpire(config.ttl)};}
return this.groups[name]=new hgm.popup.Group(name,config,counters);},open:function(){if(this.visible){return false;}
this.visible=true;return true;},close:function(){this.visible=false;},load:function(){if(!this.groups){this.groups={};this.shown=[];var hasCounters=this.loadCounters(),hasPopups=this.loadPopups();if(!hasCounters&&!hasPopups){this.upgrade();}}},loadCounters:function(){var data=hgm.storage.getOrCookie('hgm.popup.counters'),now=Date.now(),dirty=false;var all=this.counters=data?JSON.parse(data):{};$.each(all,function(name,counters){if(now>=counters._expire){delete all[name];dirty=true;}});if(dirty){this.saveCounters();}
return!!data;},saveCounters:function(){if($.isEmptyObject(this.counters)){hgm.storage.removeOrCookie('hgm.popup.counters');}
else{hgm.storage.setOrCookie('hgm.popup.counters',JSON.stringify(this.counters));}},loadPopups:function(){var data=hgm.storage.getOrCookie('hgm.popup.shown'),now=+Date.now(),dirty=false;this.shown=[];if(data){$.each(JSON.parse(data),$.proxy(function(idx,showing){if(now<showing.expire){this.shown.push(showing);}
else{dirty=true;}},this));if(dirty){this.savePopups();}
return true;}
else{return false;}},addPopup:function(showing){var found=false;$.each(this.shown,function(idx,existing){if(existing.group===showing.group&&existing.key===showing.key){existing.expire=showing.expire;found=true;return false;}});if(!found){this.shown.push(showing);}
this.savePopups();},savePopups:function(){if(!this.shown.length){hgm.storage.removeOrCookie('hgm.popup.shown');}
else{hgm.storage.setOrCookie('hgm.popup.shown',JSON.stringify(this.shown));}},upgrade:function(){var newsletter=hgm.cookie.get('email_subscribe'),modelViews=hgm.cookie.get('hgm.email.yrmd.pageview'),modelPopups=hgm.cookie.get('hgm.email.yrmd.popup'),data,SECS_PER_DAY=24*60*60,now=Date.now(),shown=this.shown,counters,dirty=false;if(newsletter==='true'){shown.push({group:'newsletter',key:'_',expire:hgm.popup.calcExpire(365*SECS_PER_DAY,now)});hgm.cookie.remove('email_subscribe');dirty=true;}
if(modelViews){try{data=JSON.parse(unescape(modelViews));if($.type(data)==='object'){counters=this.counters['make-model']={_expire:this.calcExpire(SECS_PER_DAY/2)};$.each(data,function(id,count){counters[String(id)]=3-count;dirty=true;});}}
catch(e){hgm.debug('popup - failed to parse yrmd.pageview cookie',e);}
hgm.cookie.remove('hgm.email.yrmd.pageview');}
if(modelPopups){try{data=JSON.parse(unescape(modelPopups));if($.type(data)==='object'){$.each(data,function(id){var key=String(id);shown.push({group:'make-model',key:key,expire:hgm.popup.calcExpire(180*SECS_PER_DAY,now)});counters&&delete counters[key];dirty=true;});}}
catch(e){hgm.debug('popup - failed to parse yrmd.popup cookie',e);}
hgm.cookie.remove('hgm.email.yrmd.popup');}
if(dirty){this.saveCounters();this.savePopups();}},calcExpire:function(ttl,now){return(now||Date.now())+(ttl||this.DEFAULT_TTL)*1000;},reset:function(persisted){this.groups=this.counters=this.shown=null;this.visible=false;if(persisted){hgm.storage.removeOrCookie('hgm.popup.counters');hgm.storage.removeOrCookie('hgm.popup.shown');}}};hgm.popup.Group=Class.extend({name:null,config:null,counters:null,popups:null,init:function(name,config,counters){this.name=name;this.config=config;this.counters=counters;this.popups={};},get:function(key){return this.popups[key]||(this.popups[key]=new hgm.popup.Popup(key,this));}});hgm.popup.Popup=Class.extend({key:null,group:null,visible:false,init:function(key,group){this.key=key;this.group=group;},countdown:function(){var counter=this.group.counters[this.key];if(counter===undefined){counter=this.group.config.views;}
if(--counter>=0){this.group.counters[this.key]=counter;hgm.popup.saveCounters();}
return counter<=0;},count:function(){return this.key in this.group.counters?this.group.counters[this.key]:this.group.config.views;},shown:function(){var popups=hgm.popup.shown,total=popups.length;for(var i=0;i<total;i++){var popup=popups[i];if(popup.group===this.group.name&&popup.key==this.key){return true;}}
return false;},open:function(block){if(hgm.popup.visible){return false;}
var shown=hgm.popup.shown,total=shown.length,cap=this.group.config.cap,count=0;for(var i=0;i<total;i++){var popup=shown[i];if(popup.group===this.group.name){if(popup.key==this.key||++count>=cap){return false;}}}
this.trigger();if(block||block===undefined){this.visible=true;hgm.popup.open();}
return true;},trigger:function(){hgm.popup.addPopup({group:this.group.name,key:this.key,expire:hgm.popup.calcExpire(this.group.config.expire)});},close:function(){if(this.visible){this.visible=false;hgm.popup.close();}}});}());